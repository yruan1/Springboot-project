<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>學生管理系統 - Vue 前端</title>
    <!-- Bootstrap -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app" class="container py-4">
    <h1 class="mb-4">學生管理系統 (連接 Spring Boot)</h1>

    <!-- 查詢學生 -->
    <div class="card mb-4">
        <div class="card-header">查詢學生 (依照 ID)</div>
        <div class="card-body">
            <form @submit.prevent="getStudent">
                <div class="mb-3">
                    <label class="form-label">學生 ID</label>
                    <input v-model="searchId" type="number" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-info">查詢</button>
            </form>
            <div v-if="searchResult" class="mt-3">
                <p><b>ID:</b> {{ searchResult.id }}</p>
                <p><b>姓名:</b> {{ searchResult.name }}</p>
                <p><b>Email:</b> {{ searchResult.email }}</p>
            </div>
        </div>
    </div>

    <!-- 新增學生 -->
    <div class="card mb-4">
        <div class="card-header">新增學生</div>
        <div class="card-body">
            <form @submit.prevent="addStudent">
                <div class="mb-3">
                    <label class="form-label">姓名</label>
                    <input v-model="newStudent.name" type="text" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input v-model="newStudent.email" type="email" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-primary">新增</button>
            </form>
        </div>
    </div>

    <!-- 修改學生 -->
    <div class="card mb-4">
        <div class="card-header">修改學生</div>
        <div class="card-body">
            <form @submit.prevent="updateStudent">
                <div class="mb-3">
                    <label class="form-label">學生 ID</label>
                    <input v-model="updateData.id" type="number" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">姓名</label>
                    <input v-model="updateData.name" type="text" class="form-control" />
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input v-model="updateData.email" type="email" class="form-control" />
                </div>
                <button type="submit" class="btn btn-warning">修改</button>
            </form>
        </div>
    </div>

    <!-- 刪除學生 -->
    <div class="card mb-4">
        <div class="card-header">刪除學生</div>
        <div class="card-body">
            <form @submit.prevent="deleteStudent">
                <div class="mb-3">
                    <label class="form-label">學生 ID</label>
                    <input v-model="deleteId" type="number" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-danger">刪除</button>
            </form>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                apiBase: "http://localhost:8080/student",
                searchId: "",
                searchResult: null,
                newStudent: { name: "", email: "" },
                updateData: { id: "", name: "", email: "" },
                deleteId: ""
            };
        },
        methods: {
            // 查詢學生
            async getStudent() {
                try {
                    const res = await fetch(`${this.apiBase}/${this.searchId}`);
                    if (!res.ok) throw new Error("查詢失敗");
                    const json = await res.json();
                    this.searchResult = json.data; // 重點：你的 API 是 Response 包 data
                } catch (err) {
                    alert(err);
                }
            },

            // 新增學生
            async addStudent() {
                try {
                    const res = await fetch(this.apiBase, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(this.newStudent)
                    });
                    if (!res.ok) throw new Error("新增失敗");
                    const json = await res.json();
                    alert("新增成功！學生 ID = " + json.data);
                    this.newStudent = { name: "", email: "" };
                } catch (err) {
                    alert(err);
                }
            },

            // 修改學生
            async updateStudent() {
                try {
                    const res = await fetch(
                        `${this.apiBase}/${this.updateData.id}?name=${this.updateData.name}&email=${this.updateData.email}`,
                        { method: "PUT" }
                    );
                    if (!res.ok) throw new Error("修改失敗");
                    const json = await res.json();
                    alert("修改成功！姓名 = " + json.data.name + " , Email = " + json.data.email);
                    this.updateData = { id: "", name: "", email: "" };
                } catch (err) {
                    alert(err);
                }
            },

            // 刪除學生
            async deleteStudent() {
                try {
                    const res = await fetch(`${this.apiBase}/${this.deleteId}`, {
                        method: "DELETE"
                    });
                    if (!res.ok) throw new Error("刪除失敗");
                    alert("刪除成功！");
                    this.deleteId = "";
                } catch (err) {
                    alert(err);
                }
            }
        }
    }).mount("#app");
</script>
</body>
</html>